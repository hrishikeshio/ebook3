<!doctype>
<html>

<head>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
  <title>Blockchain ebook ownership</title>
  <script type="text/javascript" src="web3.js"></script>
<style>
#message {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
     z-index: 100;
}
#inner-message {
    margin: 0 auto;
}
</style>

</head>
<body>

  <div class="container theme-showcase" role="main">

    <!-- Main jumbotron for a primary marketing message or call to action -->
    <div class="jumbotron">

      <h2>Dindle</h2>
      Current Account:<div id ="iconTop"></div><div id="account"></div><br/>
            Balance:<div id ="iconTop"></div><div id="balance"></div><br/>
      <input type="button" class="btn btn-lg btn-primary" value="Switch Account" onclick="switchAccount();" />

      <h2>Register Ownership</h2>
      <br><label for="amount">Book Name:</label><input type="text" id="bookName" value="Moby Dick"></input>
      <br><label for="receiver">Author Name:</label><input type="text" id="authorName" value="Herman Melville"></input>
      <br><label for="receiver">ImageURL:</label><input type="text" id="imageURL" value="https://midnightinthelibrary.files.wordpress.com/2013/06/moby-dick-rockwell-kent-illus.jpg"></input>
      <br><label for="receiver">BookURL (.epub file):</label><input type="text" id="bookURL" value="http://65.52.189.129/epub/moby-dick.epub"></input>
      <!-- <br><label for="receiver">Book URL:</label><input type="text" id="bookURL" value="http://d.gr-assets.com/books/1327656754l/11.jpg"></input>
       --><br><label for="receiver">Price:</label><input type="text" id="price" value="5"></input>
      <!-- <br><label for="receiver">Resell Price:</label><input type="text" id="resellPrice" value="1"></input>
      <br><label for="receiver">Resell Commission:</label><input type="text" id="resellCommission" value="1"></input> -->
      <br><label for="receiver">Publisher's address: (optional, will get 20% of revenue)</label><input type="text" id="publisher" value=""></input>
      <br><br><button id="send" onclick="register()">Register</button>
      <br><br>
      Transaction ID:<div id="result1">.</div><br/>
      <div class="footer">
        <a href="library.html">Library</a>
        | <a href="buy.html">Store</a>
      | <a href="sell.html">Sell</a>

      </div>
  </div>

  </div>

</body>
  <script type="text/javascript" src="app.js"></script>

<script type="text/javascript">
//var coinbase = web3.eth.accounts[0];
//document.getElementById("currentAddress").innerText = coinbase;
function switchAccount(){
  if(i===0){
    web3.eth.defaultAccount = web3.eth.accounts[1];
    document.getElementById('account').innerText = web3.eth.defaultAccount;
document.getElementById('balance').innerText = (web3.eth.getBalance(web3.eth.defaultAccount).toNumber()/10**15);
 
    i=1;
  }
  else if (i===1){

    web3.eth.defaultAccount = web3.eth.accounts[2];
    document.getElementById('account').innerText = web3.eth.defaultAccount;
document.getElementById('balance').innerText = (web3.eth.getBalance(web3.eth.defaultAccount).toNumber()/10**15);
 
    i=2;
  }
  else{
    web3.eth.defaultAccount = web3.eth.accounts[0];
    document.getElementById('account').innerText = web3.eth.defaultAccount;
document.getElementById('balance').innerText = (web3.eth.getBalance(web3.eth.defaultAccount).toNumber()/10**15);
 

    i=0;
  }

}
document.getElementById('publisher').value = web3.eth.accounts[1];

function register() {
  //this should be generated by ethereum
  var bookName = document.getElementById("bookName").value;
  var authorName = document.getElementById("authorName").value;
  var imageURL = document.getElementById("imageURL").value;
  var bookURL = document.getElementById("bookURL").value;
  var price = parseInt(document.getElementById("price").value);
  //var resellPrice = parseInt(document.getElementById("resellPrice").value);
  //var resellCommission = parseInt(document.getElementById("resellCommission").value);
  var publisher = parseInt(document.getElementById("publisher").value);

  var res = dindle.register(bookName, authorName, imageURL, bookURL, price, publisher, {gas: 1000000});
  console.log(res);
  document.getElementById('result1').innerText = res.toString(10);
    document.body.insertAdjacentHTML('afterbegin', '<div id="message"><div style="padding: 5px;"><div class="alert alert-success"><strong>Success!</strong>');
}

</script>

</html>
